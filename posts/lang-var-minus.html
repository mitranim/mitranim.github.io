<!doctype html><html class=""><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=2, initial-scale=1, user-scalable=yes"><link rel="icon" href="data:;base64,="><link rel="stylesheet" type="text/css" href="/styles/main.css"><title>Language Design: Gotchas With Variadic Minus</title><link rel="alternate" type="application/atom+xml" title="Mitranim's Posts (Atom)" href="/feed.xml"><link rel="alternate" type="application/rss+xml" title="Mitranim's Posts (RSS)" href="/feed_rss.xml"><meta name="author" content="Nelo Mitranim"><meta property="og:title" content="Language Design: Gotchas With Variadic Minus"><meta name="description" content="Treating the minus operator as a function can be tricky and dangerous"><meta property="og:site_name" content="about:mitranim"></head><body id="top" class="flex col-sta-str" style="min-height: 100vh"><header class="wid-lim --unpadded flex row-sta-str mar-bot-2 gap-hor-1"><nav class="flex row-sta-str"><a href="/" class="navlink --busy">home</a><a href="/works" class="navlink --busy">works</a><a href="/posts" class="navlink --busy">posts</a></nav><span class="flex-1"></span><span class="fg-blue flex row-cen-cen pad-1 sm-hide">Updated: Nov 20 2021</span></header><div role="main" id="main" class="wid-lim fan-typo"><article role="article" class="fan-typo"><h1><span class="heading-prefix" aria-hidden="true"></span>Language Design: Gotchas With Variadic Minus</h1><p role="doc-subtitle" class="size-large italic">Treating the minus operator as a function can be tricky and dangerous</p><p class="fg-gray-close size-small">published Oct 17 2020</p><p><strong>TLDR</strong>: variadic <code>-</code>, as seen in Lisps, has gotchas; it may be allowed syntactically, but not as a variadic function.</p>

<p><code>-</code> tends to be overloaded with two different operations: negation and subtraction. Negation is always unary. Subtraction can be variadic. Unary subtraction is an identity function that returns the first argument unchanged <em>without negating it</em>.</p>

<pre><code>ƒ negate(a)         = 0 - a

ƒ subtract(a)       = a
ƒ subtract(a b)     = a - b
ƒ subtract(a b c)   = (a - b) - c
ƒ subtract(a b c d) = ((a - b) - c) - d
</code></pre>

<p>In math and many programming languages, there&rsquo;s no ambiguity because <code>-</code> is either unary prefix (negation) or binary infix (subtraction):</p>

<pre><code>-A       |    Negation.
B - C    |    Subtraction.
</code></pre>

<p>But in Lisps, <code>-</code> is always prefix, always variadic, and when called with a single argument, it always negates it.</p>

<p>The following examples use <a href="https://racket-lang.org" target="_blank" rel="noopener noreferrer">Racket<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a>. Let&rsquo;s dynamically pass N arguments to <code>-</code>:</p>
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822"><span style="color:#f92672">#</span>lang racket/base

(<span style="color:#66d9ef">define </span>(<span style="color:#a6e22e">subtract</span> <span style="color:#f92672">.</span> args) (apply - args))

(<span style="color:#a6e22e">println</span> (<span style="color:#a6e22e">subtract</span> <span style="color:#ae81ff">11</span> <span style="color:#ae81ff">33</span> <span style="color:#ae81ff">55</span>))
(<span style="color:#a6e22e">println</span> (<span style="color:#a6e22e">subtract</span> <span style="color:#ae81ff">11</span> <span style="color:#ae81ff">33</span>))
(<span style="color:#a6e22e">println</span> (<span style="color:#a6e22e">subtract</span> <span style="color:#ae81ff">11</span>))
</pre><pre tabindex="0" style="color:#f8f8f2;background-color:#272822"><span style="color:#ae81ff">-77</span>
<span style="color:#ae81ff">-22</span>
<span style="color:#ae81ff">-11</span> <span style="color:#75715e">; Performed negation, not subtraction!</span>
</pre>
<p>The last call performed <em>negation</em> on its only argument.</p>

<p>Correct variadic subtraction:</p>
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822"><span style="color:#f92672">#</span>lang racket/base

(<span style="color:#66d9ef">define </span>(<span style="color:#a6e22e">flip</span> fun) (<span style="color:#66d9ef">lambda </span>(<span style="color:#a6e22e">a</span> b) (<span style="color:#a6e22e">fun</span> b a)))
(<span style="color:#66d9ef">define </span>(<span style="color:#a6e22e">foldl1</span> fun seq) (<span style="color:#a6e22e">foldl</span> fun (car seq) (cdr seq)))
(<span style="color:#66d9ef">define </span>(<span style="color:#a6e22e">subtract</span> <span style="color:#f92672">.</span> args) (<span style="color:#a6e22e">foldl1</span> (<span style="color:#a6e22e">flip</span> -) args))

(<span style="color:#a6e22e">println</span> (<span style="color:#a6e22e">subtract</span> <span style="color:#ae81ff">11</span> <span style="color:#ae81ff">33</span> <span style="color:#ae81ff">55</span>))
(<span style="color:#a6e22e">println</span> (<span style="color:#a6e22e">subtract</span> <span style="color:#ae81ff">11</span> <span style="color:#ae81ff">33</span>))
(<span style="color:#a6e22e">println</span> (<span style="color:#a6e22e">subtract</span> <span style="color:#ae81ff">11</span>))
</pre>
<pre><code>-77
-22
11
</code></pre>

<p>Now, <code>11</code> was correctly returned as-is.</p>

<p>Worth comparing to Haskell, which also generalizes operators into functions, but handles <code>-</code> differently. In Haskell, the function <code>-</code> is always binary subtraction:</p>
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822"><span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">do</span>
  print (foldl1 (<span style="color:#f92672">-</span>) [<span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">55</span>])
  print (foldl1 (<span style="color:#f92672">-</span>) [<span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">33</span>])
  print (foldl1 (<span style="color:#f92672">-</span>) [<span style="color:#ae81ff">11</span>])
</pre>
<pre><code>-77
-22
11
</code></pre>

<p>Haskell doesn&rsquo;t allow to overload functions on parameter count. You can&rsquo;t define <code>-</code> as both unary and binary. So they special-cased unary <code>-</code> in the <em>syntax</em>, converting it to <code>negate</code>:</p>
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822"><span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">do</span>
  print (<span style="color:#f92672">-</span><span style="color:#ae81ff">11</span>)
  print (negate <span style="color:#ae81ff">11</span>)
</pre><pre tabindex="0" style="color:#f8f8f2;background-color:#272822"><span style="color:#f92672">-</span><span style="color:#ae81ff">11</span>
<span style="color:#f92672">-</span><span style="color:#ae81ff">11</span>
</pre>
<p>Lisp and Haskell create this problem for themselves by treating <code>-</code> as a function while overloading it with <em>two</em> different functions. Most languages don&rsquo;t have this problem because they don&rsquo;t have <code>-</code> as a function. Languages with operator overloading tend to differentiate between negation and subtraction. For example, Rust has <code>ops::Neg</code> and <code>ops::Sub</code>. Literal <code>-</code> is converted into calls to one of those. When passing it to a higher-order function, you either pass <code>ops::Neg::neg</code>, or <code>ops::Sub::sub</code>, avoiding the problem completely.</p>
</article><hr><p>This blog currently doesn't support comments. Feel free to <a href="https://twitter.com/mitranim" class="decorate-link" target="_blank" rel="noopener noreferrer">tweet<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a> at me, email to <a href="mailto:me@mitranim.com?subject=Re: Language Design: Gotchas With Variadic Minus">me@mitranim.com</a>, or use the <a href="/#contacts">other contacts</a>.</p><p class="inl-flex row-sta-sta gap-hor-0x5"><span>Subscribe using one of:</span><a href="/feed.xml" class="decorate-link" target="_blank" rel="noopener noreferrer">Atom<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a><a href="/feed_rss.xml" class="decorate-link" target="_blank" rel="noopener noreferrer">RSS<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a><a href="https://feedly.com/i/subscription/feed/https://mitranim.com/feed.xml" class="decorate-link" target="_blank" rel="noopener noreferrer">Feedly<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a></p></div><footer style="margin-top: auto"><div class="wid-lim flex row-bet-cen mar-top-4 mar-bot-2"><span class="flex-1 flex row-sta-sta gap-hor-0x5"><span class="text-lef">2014—2021</span><a href="https://github.com/mitranim/mitranim.github.io" class="decorate-link" target="_blank" rel="noopener noreferrer">website source<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a></span><span class="flex-1 text-cen"><a href="/#contacts" class="decorate-link">touch me</a></span><span class="flex-1 flex row-end-cen gap-hor-0x5"><a href="#top" class="fill-gray-fg-close pad-1 busy-bg-gray-close" onclick="event.preventDefault(); window.scrollTo(0, 0)" aria-label="scroll up"><svg class="svg-icon fill-fg" viewBox="0 0 448 512" width="1em" height="1em"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></span></div></footer></body></html>