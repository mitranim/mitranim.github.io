<!doctype html><html lang="en" class=""><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="data:;base64,="><link rel="stylesheet" type="text/css" href="/styles/main.css"><title>Rant on Tree-Sitter (and Zed)</title><link rel="alternate" type="application/atom+xml" title="Mitranim's Posts (Atom)" href="/feed.xml"><link rel="alternate" type="application/rss+xml" title="Mitranim's Posts (RSS)" href="/feed_rss.xml"><meta name="author" content="Nelo Mitranim"><meta property="og:title" content="Rant on Tree-Sitter (and Zed)"><meta name="description" content="Impressions after dabbling into Tree-Sitter syntaxes and trying the Zed editor"><meta name="og:description" content="Impressions after dabbling into Tree-Sitter syntaxes and trying the Zed editor"><meta property="og:site_name" content="about:mitranim"></head><body id="top"><header class="header"><ul class="flex row-sta-str"><li><a href="/">home</a></li><li><a href="/works">works</a></li><li><a href="/posts">posts</a></li><li><a href="/games">games</a></li></ul><span class="flex-1"></span><span class="header-update" aria-label="last update anywhere on the site">updated: 2025-Oct-08</span></header><article role="main" id="main" class="main article"><h1 class="heading-prefix">Rant on Tree-Sitter (and Zed)</h1><p class="post-desc">Impressions after dabbling into Tree-Sitter syntaxes and trying the Zed editor</p><p class="post-time">written 2025-Oct-08, updated 2025-Oct-08</p><h2 id="preface" class="heading-prefix">Preface<a href="#preface" class="heading-anchor" aria-hidden="true"></a></h2><p>I write code and prose in <a href="https://sublimetext.com" target="_blank" rel="noopener noreferrer">Sublime Text<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a>. Over the years, I ended up writing many syntaxes for it, some of which (reworks of Clojure and Go) got officially adopted. This required understanding ST's syntax engine, which is simultaneously simple and special.</p>

<p>Sublime's syntax engine uses a pushdown automaton (PDA), which pushes and pops &quot;contexts&quot;. Every context matches some text, gives it a &quot;scope&quot;, and optionally modifies the stack by pushing another context (or several) or popping when done. Matching is regex-based, using Sublime's own optimized regex engine. You can assign different scopes to different captures in a single match, and contexts can re-match an earlier match via <code>\1</code>. This engine can handle any context-free grammar.</p>

<p>A syntax is a YAML file which defines some metadata (how to detect files), some variables (for reuse), and a bunch of contexts. Writing one is very fluid: the editor detects changes and reloads the syntax on the fly. Furthermore, syntaxes can <em>inherit</em> from each other, with additions and overrides. This allows easy reuse in syntax &quot;families&quot; such as SQL, and the user can easily customize built-in syntaxes by inheriting and adding their own features. I use this for embedding, such as SQL-in-Go.</p>

<p>Sublime also uses syntaxes for symbol indexing. When you open a directory, it runs the syntax engine on every file and collects the symbols. This is fast enough to index large repositories in seconds. Sublime doesn't even bother to cache symbol indexes to disk. Result? Global symbol search and goto any symbol from anywhere, without an LSP, and goto works across languages (important for me).</p>

<p>Strangely, no other major editor implements this.</p>
<h2 id="rant" class="heading-prefix">Rant<a href="#rant" class="heading-anchor" aria-hidden="true"></a></h2>
<p>Been playing with the <a href="https://zed.dev" target="_blank" rel="noopener noreferrer">Zed editor<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a>. It's very nice, very snappy, behind Sublime in some ways, ahead in some other ways. Like every editor which isn't Sublime, it's fatally defective (for me) due to the <a href="https://github.com/zed-industries/zed/issues/13307" target="_blank" rel="noopener noreferrer">lack<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a> of syntax-based symbol indexing and goto. It relies on LSPs, which don't exist for many languages and don't support cross-language goto. Like many recent editors, it uses <a href="https://tree-sitter.github.io" target="_blank" rel="noopener noreferrer">Tree-Sitter<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a> for syntaxes.</p>

<p>Since I'm working on a new language and have a Sublime syntax for it, I dabbled into making a Tree-Sitter syntax. And what a horror it turned out to be. Install an NPM lib that runs in Node to execute JavaScript to generate C then shell out to a C compiler... What?? You have to run its special CLI to initialize a project and it splurges out binding templates for six languages, which is still not enough, because every language which wants to use this stuff needs its own bindings for <em>every syntax</em> so you get <code>N*M</code> integration complexity... What??? When making changes to a syntax, I have to rerun two separate CLI commands just to build this stuff, and another one to test it... What??!!! How <em>on earth</em> did they manage to get this so wrong?!</p>

<p>Sublime's way is so obvious: write <em>one</em> implementation of an automaton that interprets a syntax file described with data; make it a library and write bindings for all languages just <em>once</em>; keep syntax files portable, and watch and reload them without having to shell out to a C compiler!</p>

<p>Oh, and after <em>all that</em>, T-S <em>still</em> <strong>can't handle heredocs</strong> (variable-length delimiters) which exist in shell, SQL, Markdown, and my own languages, so you <strong><em>have to write custom C code</em></strong> for what's done with <code>\1</code> in Sublime syntax.</p>

<p>I don't understand how they managed to push this garbage approach so hard without people revolting. Rant over.</p>
<h2 id="ps" class="heading-prefix">PS<a href="#ps" class="heading-anchor" aria-hidden="true"></a></h2>
<p>I'm not attacking people; I'm attacking bad ideas.</p>

<p>Symbol indexing is an offtopic here. T-S can obviously be used for it. But as a syntax author, I never want to deal with it.</p>

<p>We could still fix this. All we need is one open source implementation of Sublime's engine (convince Sublime HQ to release theirs?), and then other editors could switch to its much less painful approach (from syntax author perspective).</p>

<p>The PDA approach is obviously not perfect. It requires the author to <em>think</em> like a PDA, which is easy enough if you routinely program in assembly or Forth, but otherwise requires training.</p>

<p>However, we have an amazing high level solution: <a href="https://github.com/BenjaminSchaaf/sbnf" target="_blank" rel="noopener noreferrer">SBNF<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a>, which produces Sublime syntax files from sources written in a specialized variant of the Backus-Naur form. Those <a href="https://github.com/BenjaminSchaaf/sbnf/blob/master/sbnf/sbnf.sbnf" target="_blank" rel="noopener noreferrer">sources<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a> are just as high level as Tree-Sitter, but can also handle heredocs without custom C code. Currently this requires syntax authors to run SBNF and distribute YAML. But SBNF, or something very similar, could be integrated into editors. Syntax authors would just write SBNF files, and editors would interpret them. No JS→C toolchain needed.</p>
</article><hr class="hr mar-ver-1 pad-hor-body"><p class="pad-hor-body">This blog currently doesn't support comments. Write to me via <a href="/#contacts" class="link-deco">contacts</a>.</p><p class="feed-links pad-hor-body"><span>Subscribe using one of:</span><a href="/feed.xml" class="link-deco" target="_blank" rel="noopener noreferrer">Atom‍<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a><a href="/feed_rss.xml" class="link-deco" target="_blank" rel="noopener noreferrer">RSS‍<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a><a href="https://feedly.com/i/subscription/feed/https://mitranim.com/feed.xml" class="link-deco" target="_blank" rel="noopener noreferrer">Feedly‍<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a></p><footer class="footer"><span class="flex-1 flex row-sta-cen gap-hor-0x5 pad-lef-body"><span class="text-lef">2014-2025</span><a href="https://github.com/mitranim/mitranim.github.io" class="link-deco wspace-nowrap" target="_blank" rel="noopener noreferrer">code‍<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; width: 1.5ex; height: 1.5ex; margin-left: 0.3ch;" aria-hidden="true"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg></a></span><span class="flex-1 text-cen"><a href="/#contacts" class="link-deco">touch me</a></span><span class="flex-1 flex row-end-cen"><a href="#top" class="fill-gray-fg-near pad-body busy-gray-bg" onclick="event.preventDefault(); window.scrollTo(0, 0)"><svg class="svg-icon fill-fg" viewBox="0 0 448 512" width="1em" height="1em"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></span></footer></body></html>